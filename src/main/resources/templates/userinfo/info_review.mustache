{{>layout/header}}

<div class="userinfo_category">
    <a href="/{{uid}}">
        <div class="userinfo_shortcuts">회원정보 수정</div>
    </a>
    <a href="/{{uid}}/review">
        <div class="userinfo_current">리뷰 관리</div>
    </a>
    <a href="/{{uid}}/like">
        <div class="userinfo_shortcuts">즐겨찾기 관리</div>
    </a>
</div>

<div class="userinfo_background">
    <div class="userinfo_title">작성한 리뷰</div>

    <table>
        <tbody>
        {{#reviews}}
            <tr>
                <td>{{body}}</td>
                <td>{{#store}}{{store_name}}{{/store}}</td>
                <td>
                    <button class="button" onclick="openModal()"
                            data-bs-toggle="modal"
                            data-bs-target="#review-edit-Modal"
                            data-bs-id="{{id}}"
                            data-bs-store="{{store}}"
                            data-bs-userid="{{userid}}"
                            data-bs-body="{{body}}">수정
                    </button>
                    <button class="button review-delete-btn" data-review-id={{id}}>삭제</button>
                </td>
            </tr>
        {{/reviews}}
        </tbody>
    </table>

    <div id="modalBackground" class="modal-background"></div>

    <div id="review-edit-Modal" class="modal">
        <span id="closeModal">&times;</span>
        <h2>수정하기</h2>
        <form id="ReviewEditForm">
            <input type="hidden" id="edit-review-id">
            <input type="hidden" id="edit-review-store">
            <input type="hidden" id="edit-review-userid">
            <textarea type="text" id="edit-review-body"></textarea>
            <button type="button" id="review-update-btn">수정 완료</button>
        </form>
    </div>
</div>

<!--모달 열기,닫기-->
<script>
    {
        // 모달 열기 함수
        function openModal() {
            document.getElementById("review-edit-Modal").style.display = "block";
        }

        // 모달 닫기 함수
        document.getElementById("closeModal").onclick = function () {
            document.getElementById("review-edit-Modal").style.display = "none";
        }
    }
</script>

<!--댓글 수정-->
<script>
    {
        const reviewEditButton = document.querySelectorAll(".button[data-bs-toggle='modal']");
        reviewEditButton.forEach(btn => {
            btn.addEventListener("click", (event) => {
                const review = event.target;

                const id = review.getAttribute("data-bs-id");
                const store = review.getAttribute("data-bs-store");
                const userid = review.getAttribute("data-bs-userid");
                const body = review.getAttribute("data-bs-body");

                document.querySelector("#edit-review-id").value = id;
                document.querySelector("#edit-review-store").value = store;
                document.querySelector("#edit-review-userid").value = userid;
                document.querySelector("#edit-review-body").value = body;

                openModal();
            });
        });
    }
    {
        const reviewUpdateButton = document.querySelector("#review-update-btn");
        reviewUpdateButton.addEventListener("click", function (){
            const review = {
                id: document.querySelector("#edit-review-id").value,
                store: document.querySelector("#edit-review-store").value,
                userid: document.querySelector("#edit-review-userid").value,
                body: document.querySelector("#edit-review-body").value
            };
            console.log(review);

            // 수정 REST API 호출
            const url = "/api/reviews/" + review.id;
        });
    }
</script>

<!--댓글 삭제-->
<script>
    {
        const reviewDeleteButton = document.querySelectorAll(".review-delete-btn");
        reviewDeleteButton.forEach(btn => {
            btn.addEventListener("click", (event) => {
                const DeleteBtn = event.target;
                const reviewId = DeleteBtn.getAttribute("data-review-id");
                console.log(`삭제 버튼 클릭: ${reviewId}번 댓글`);
            });
        });
    }
</script>

{{>layout/footer}}

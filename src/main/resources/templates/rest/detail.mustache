{{>layouts/detail_header}}

<!--body-->
<div class="background">
    <a href="/storelist"><img src="/img/back_icon.png" width="50" class="back"></a>
    {{#user}}
        <input type = "hidden" id = "new-like-userid" value ="{{id}}">
    {{/user}}
    {{#rest}}
        <input type="hidden" id="new-like-store-id" value="{{id}}">
        <img src="{{store_img}}" class="rest_img">
        <div class="background2">
            <div class="store_name">
                {{store_name}}
            </div>
            <div class="bookmark" id="like-{{id}}">
                <img id="bookmark_img" src="/img/bookmark_x.png" alt = "" width="25">
                <!--        "https://icons8.com/icon/60003/%EB%B3%84"-->
            </div>
        </div>
            <div class="rest_detail">
                <table>
                    <tr>
                        <td style="width:20%; font-weight: 500">영업시간</td>
                        <td style="width:80%; font-weight: 300">{{store_time}}</td>
                    </tr>
                    <tr>
                        <td style="width:20%; font-weight: 500">주소</td>
                        <td style="width:80%; font-weight: 300">{{store_address}}</td>
                    </tr>
                    <tr>
                        <td style="width:20%; font-weight: 500">대표번호</td>
                        <td style="width:80%; font-weight: 300">{{store_phone}}</td>
                    </tr>
                    <tr>
                        <td style="width:20%; font-weight: 500">별점</td>
                        <td style="width:80%; font-weight: 300">{{store_star}}</td>
                    </tr>
                </table>

            </div>
    {{/rest}}
</div>

<script type="text/javascript">
    let state = 0;
    const url = "/api/" + document.querySelector("#new-like-userid").value + "/" + document.querySelector("#new-like-store-id").value + "/likes";
    fetch(url)
        .then(response => {
            if(!response.ok){
                throw new Error('Server response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            if(data == null){
                document.getElementById('bookmark_img').src = "/img/bookmark_x.png";
                state = 0;
            }
            document.getElementById('bookmark_img').src = "/img/bookmark_o.png";
            state = 1;
        }).catch(error =>{
            console.error('There was a problem with the fetch operation:', error);
        });

    const likeCreate = document.getElementById('bookmark_img');
    likeCreate.addEventListener("click", function(){
        if(state ===0){
            state = 1;
            document.getElementById('bookmark_img').src = "/img/bookmark_o.png";
            const like = {
                user_id: document.querySelector("#new-like-userid").value,
                store_id: document.querySelector("#new-like-store-id").value,
                like_state: 1,
            };
            const url = "/api/" + like.user_id + "/" + like.store_id + "/likes";
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(like)
        }).then(response => response.json())
                    .then(data => {
                        let like_id = data.id;
                        console.log("생성된 좋아요 id: " + like_id);
                        let like_state = data.state;
                        window.location.reload();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert("좋아요 생성 실패");
                    });
    }
</script>
